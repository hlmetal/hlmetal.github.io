---
layout: post
title:  "数据库入门"
date:   2018-03-15 14:28:30 +0200
categories: database
---

数据库入门，了解什么是数据库，数据库类型，以及oracl数据库的基本知识。

## 数据库简介
数据库即存储数据的仓库，它按照一定的数据结构来存储和管理数据。
## 类型
### 关系型数据库
关系型数据库存储的格式可以直观反映实体间的关系。一个关系数据库由多个数据表组成，数据表是关系数据库的基本存储结构。常见的关系型数据库有MySQL、SQLServer、Oracle等。
#### 结构化查询语言(SQL)
* SQL是在关系数据库上执行数据操作，检索及维护所使用的标准语言，可以用来查询数据，操纵数据，定义数据，控制数据。所有数据库管理系统都支持该标准。
* SQL分类
    * DDL数据定义语言,用于建立，修改，删除数据库对象(表，视图，索引，序列)，create，alter，drop，truncate
    * DML,数据操纵语言，用于改变数据表中的数据，insert，update，delete
    * TCL,事务控制语言，用于维护数据一致性的语句；commit，rollback，savepoint
    * DQL,数据查询语言，用来查询所需要的数据，select
    * DCL,数据控制语言，用于执行权限的授予和收回操作，grant，revoke，create user

### 非关系型数据库(NoSQL)
出于简化数据库结构、避免冗余、影响性能的表连接、摒弃复杂分布式的目的, NoSQL数据库随之出现，常见的有MongoDB, Redis等。

### NoSQL与关系型数据库区别
1. 存储方式
—关系型数据库采用表格的储存方式, 数据以行和列的方式进行存储, 读取和查询十分方便。
—非关系型数据通常以数据集的方式，大量的数据集中存储在一起, 类似于键值对、图结构等。
2. 存储结构
—关系型数据库按照结构化的方法存储数据,每个数据表都必须对各字段定义好,再根据表的结构存入数据。
—NoSQL数据库由于面对的是大量非结构化的数据的存储，它采用的是动态结构，对于数据类型和结构的改变非常的适应，可以根据数据存储的需要灵活的改变数据库的结构。
3. 查询方式
—关系型数据库采用结构化查询语言（即SQL）来对数据库进行查询,它能够支持数据库的CRUD操作，具有非常强大的功能，SQL可以采用类似索引的方法来加快查询操作。
—NoSQL数据库使用的是非结构化查询语言（UnQL），它以数据集为单位来管理和操作数据，由于它没有一个统一的标准，所以每个数据库厂商提供产品标准是不一样的，NoSQL中的文档Id与关系型表中主键的概念类似，NoSQL数据库采用的数据访问模式相对SQL更简单而精确。
4. 事务性
—关系型数据库强调ACID规则, 即原子性(Atomicity)、一致性(Consistency)、隔离性(Isolation)、持久性(Durability),可以满足对事务性要求较高或者需要进行复杂数据查询的数据操作。关系型数据库十分强调数据的强一致性，关系型数据库可以控制事务原子性细粒度，并且一旦操作有误或者有需要，可以马上回滚事务。
—NoSQL数据库强调BASE原则, 即基本可用(Basically Available)、软状态(Soft-state)、最终一致性(Eventual Consistency)，它减少了对数据的强一致性支持，从而获得了基本一致性和柔性可靠性，并且利用以上的特性达到了高可靠性和高性能，最终达到了数据的最终一致性。NoSQL数据库虽然对于事务操作也可以使用，但由于它是一种基于节点的分布式数据库，对于事务的操作不能很好的支持，也很难满足其全部的需求，所以NoSQL数据库的性能和优点更多的体现在大数据的处理和数据库的扩展方面。
5. 读写性能
—关系型数据库十分强调数据的一致性，并为此降低读写性能付出了巨大的代价，虽然关系型数据库存储数据和处理数据的可靠性很不错，但一旦面对海量数据的处理的时候效率就会变得很差，特别是遇到高并发读写的时候性能就会下降的非常厉害。
—NoSQL数据库的优势恰恰是应对大数据方面，对于大量的每天都产生非结构化的数据能够高性能的读写，这是因为NoSQL数据库是按key-value类型进行存储的，以数据集的方式存储的，无论是扩展还是读写都非常容易，并且NoSQL数据库不需要关系型数据库繁琐的解析，所以NoSQL数据库大数据管理、检索、读写、分析以及可视化方面具有关系型数据库不可比拟的优势。

### 分布式数据库
分布式数据库结合了数据库技术与分布式技术。具体指的是把那些在地理意义上分散开的各个数据库节点，但在计算机系统逻辑上又是属于同一个系统的数据结合起来的一种数据库技术。既有着数据库间的协调性也有着数据的分布性。
在分布式数据库里，数据冗杂是一种被需要的特性，这点和一般的集中式数据库系统不一样。第一点是为了提高局部的应用性而要在那些被需要的数据库节点复制数据。第二点是因为如果某个数据库节点出现系统错误，在修复好之前，可以通过操作其他的数据库节点里复制好的数据来让系统能够继续使用，提高系统的有效性。

## DB和DBMS
DB即Database, 是数据库本身, 而DBMS即Database Management System, 它是管理数据库的软件。

## Oracl数据库
### Oracle数据类型
1. NUMBER数字类型：NUMBER(P,S),P表示数字的总位数，S表示小数点后位数，整数位最大4位, 小数位最大为2位
2. CHAR固定长度字符类型：CHAR(N)，最大长度是2000字节
3. VARCHAR2变长字符类型：VARCHAR2(N)，最大长度是40000字节
4. DATE日期时间：长度是7个字节，默认格式：DD-MON-RR.
5. LONG:最多达2GB字符串数据，有很多存储限制，每个表只有一个，不能为主键，不能建立索引，不能出现在查询条件中
### 创建表
1. CREATE TABLE tablename（，，，，）
2. 查看表结构 DESC tablename
3. 给列指定默认值 DEFAULT：
SQL语句本身不区分大小写，但那时字符串中大小写敏感，字符串的字面量在数据库中以单引号括起来，数据库中所有数据类型的默认值都是NULL；
4. NOT NULL 非空约束条件，用于确保字段值不为空
### 修改表
1. 修改表名：RENAME old_name TO new_name;
2. 修改表结构：添加新字段：ALTER TABLE table_name ADD(字段名 数据类型)
3. 修改现有字段：ALTER TABLE table_name MODIFY(字段名 数据类型() 默认值)。可修改字段类型，长度，添加默认值，或者非空约束，修改字段最好在表中没数据时进行，否则尽量不修改类型，长度只增不减，否则可能导致修改失败
4. 删除现有字段：ALTER TABLE table_name DROP(字段名)
5. TRUNCATE TABLE table_name  DDL语句不受事务控制，直接清空表，不能回滚
### 数据操作DML
1. 插入数据： INSERT INTO table_name(字段名) VALUES(值)；插入时不指定字段则是全列插入
2. 插入日期字段：使用默认日期格式：DD-MON-RR，使用自定义日期格式：TO_DATE()
3. 修改数据：UPDATE table_name SET 字段名=值 WHERE 字段名=值；修改时通常加WHERE,只修改满足条件的，否则全表修改
4. 删除数据：DELETE FROM table_name WHERE ；不添加WHERE是清空表操作
5. 字符串操作

### 数据查询DQL
1. SELECT语句中必须包含至少两个子句，分别是SELECT和FROM; SELECT子句用来指定要查询的字段，FROM子句用来指定数据来源的表;SELECT中除了可以指定表中具体字段外,还可以指定一个函数或表达式。
2. SELECT语句中添加WHERE字句可以仅查询出满足条件的记录;
3. 字符串函数：
    * CONCAT(char1,char2)返回两个字符串连接后的结果;
    * UPPER(),LOWER()大小写转换;
    * TRIM，LTRIM，RTRIM去除字符串两端的指定内容;
    * LPAD(CHAR1,N,CHAR2),RPAD补位函数,将char1显示n位，若char1不足n位时左(右)补充若干个char2字符以达到位数;
    * SUBSTR(char,m[,n])截取char字符串，从m处开始，连续截取n个字符，需要注意，数据库中下标都是从1开始的，n若不指定或指定的数字超过可以截取的实际字符长度时都是截取到当前字符串末尾。若m为负数，则是从倒数位置开始截取;
    * INSTR(char1,char2[,n[,m]])查看char2在char1中的位置，n和m不指定默认都是1，n表示从第几个字符开始，m表示查看第几次出现;
4. 数值函数：
    * ROUND(n[,m])：用于四舍五入；保留n小数点后m位，m不写默认为0，即保留到整数位，m若为负数，则是保留10位以上的数字;
    * TRUNC(n[,m]):参数意义与ROUND一致，但不四舍五入;
    * MOD(m,n)：返回m除以n后的余数，n为0则直接返回m；
    * CEIL和FLOOR：前者返回大于该数的最小整数，后者返回小于该数的最大整数；（向上取整，向下取整）
5. 日期类型相关函数：
    * TO_DATE():日期转换函数，将给定字符串按照给定的日期格式解析为一个DAE值,日期格式字符串中不是字母或常用符号的其他字符都需要使用双引号括起来;
    * LAST_DAY(date):返回日期date所在月的最后一天;
    * ADD_MONTHS(date，i)对指定日期加上指定月，若i为负数，则是减去;
    * MONTHS_BETWEEN(date1,date2)；date1与date2之间相隔多少月;
    * NEXT_DAY(date,char)返回date日期数据的下一个周几，周几是有char来决定；1表示周日，2表示周一...
    * LEAST,GREATEST:最小值与最大值，凡是可以比较大小的数据类型都可以使用这两个函数，对于日期当中，最大值即最晚日期，最小值即最早日期，可以有多个参数;
    * EXTRACT(YEAR/MONTH/DAY...，SYSDATE):提取一个日期中指定时间分量的值;
    * RR与YY都是用两位数字数字表示年，但是当使用TO_DATE函数将两位数字解析为实际日期时，RR会自行判定世纪，而YY不会; 
    * SYSDATE:返回一个表示当前系统时间的DATE值;SYSTIMESTAMP：返回当前时间的时间戳类型值;
    * 对一个日期加减一个数字，等同于计算加减天数；两个日期相减，差为相差的天数；日期之间比大小，越晚的越大

### 查询条件中使用表达式和函数
1. DISTINCT(去除结果集的重复值),多字段去重时，是保证字段组合的值不重复
2. ORDER BY子句可以对结果集进行升序或降序排列 只能在DQL的最后一个子句上；ASC 不写也默认为升序，DESC 降序 ；排序含有NULL值的字段时，NULL被认为是最大值；
3. 聚合函数(分组/多行函数)：用来统计，将结果集按照指定字段进行统计，得到一个值。MAX,MIN,AVG,SUM;COUNT(对结果集记录数的统计函数)
4. GROUP BY子句可以将结果集按照指定的字段值一样的记录看作同一组，配合聚合函数使用可以对魅族的数据进行统计并得到结果。当SELECT子句中使用了聚合函数时，那么凡是不在聚合函数中单独字段都必须出现在GROUP BY子句中。GROUP BY使用多个字段进行分组时，是将这些字段值的组合一样的记录看作一组.
```
SELECT deptno,AVG(sal)
FROM emp
WHERE AVG(sal)>2000
GROUP BY deptno;
```
——上面的SQL语句会报错，WHERE中不能使用聚合函数作为过滤条件，原因在于过滤时机不对
——WHERE是在第一次检索表时，逐行过滤数据以产生查询结果集时使用的，而聚合函数是用来统计，
——那么前提是有数据，所以要将所有数据查询出来才能统计，之后才可以进行过滤，这实际是在WHERE之后进行的。
——若想使用聚合函数的结果进行过滤，那么需要使用HAVING子句，
——HAVING必须跟在GROUP BY子句之后，作用是添加过滤条件将不满足的分组去除，而HAVING中允许使用聚合函数作为过滤条件

### 关联查询
联合多张表查询数据几关联查询。查询的结果集中字段来自多张表，关联查询的重点是链接条件。
关联查询通常要加链接条件，不加则会出现笛卡儿积，笛卡儿积通常是一个无意义的结果集，笛卡儿积是将关联查询表中的数据一一链接一遍而产生的结果集，数据量为关联查询表数据量的乘积。
1. 内链接：关联查询忽略不满足链接条件的记录
2. 外链接：外链接在关联查询中除了可以将满足链接条件的几率查询出来之外，还可以将满足链接条件的记录也查询出来。
3. 左外连接：以JOIN左侧表作为驱动表（所有数据都要显示出来），那么当该表某条记录不满足链接条件时来自右侧表中的字段值全部为空。
4. 右外连接，全外连接；
5. 自链接：树状结构（商品类别，地区选择，员工等）
19.子查询：是嵌套在其他SQL语句当中的，目的是为嵌套的SQL提供数据，以便其执行。

### 其他
1. 字段的别名：当一个SELECT子句中含有函数或者表达式时，查询出来的结果集中对应该字段的名字就是函数表达式，不易理解，可读性差，为此可以为这样的字段单独指定别名。
2. 使用AND ,OR关键字,OR的优先级低于AND，所以若希望提高OR的优先级可以使用括号；
3. 模糊查询：LIKE;%:表示0到多个字符；_：表示单个字符
4. IN 和 NOT IN 判断在列表中或不在列表中
5. BETWEEN...AND..：判断在一个范围内
6. ANY和ALL：不能单独用,需要配合比较操作符>,>=,<,<一起使用，>ANY(大于最小)，>ALL(大于最大)
7. 查询语句执行顺序：from--执行顺序从后往前，从右到左，where--自下而上，从右到左，group by--从左往右分组，having，select--少用*，尽量取字段名，order by--从左到右排序
8. 在DDL与DML中也可以使用子查询；在DDL中使用子查询，可以将一个子查询的结果集当作表快速创建。
9. 子查询根据查询结果不同，分为单列子查询，多行单列子查询和多行多列子查询。其中单列子查询常用在过滤条件中，而多列子查询通常当作表看待；
10. 对于多行单列子查询在作为过滤条件进行判断时，要配合IN,ANY,ALL使用。
11. EXISTS关键字用在过滤条件中，其后需要跟一个子查询，当该子查询可以查出至少一条记录时，即判定为满足条件。
12. 分页查询：当一个查询语句查询的数据量非常大时，需要分段将数据查询出来，这样做可以减少系统资源开销，提高数据库响应速度。分页由于在标准SQL中未定义，所以不同数据库有不同语法。ROWNUM:伪列；配合完成分页查询。即行号(pageSize：每页显示的条目，page：页数； start：（page-1）*pageSize+1，end：pageSize*pag)
13. DECODE函数：类似于switch-case,在分组中使用可以将字段值不同的记录划分为一组
14. 排序函数:对结果集按照指定字段分组，在组内按指定字段排序，然后生成组内行号;ROW_NUMBER:生成组内连续且唯一的数字；RANK：生成组内不连续不唯一的数字;DENSE_RANK:生成组内连续不唯一的数字;
